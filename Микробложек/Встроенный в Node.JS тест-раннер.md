В 20й версии [[Node.JS]] нам принесли стабильный [[тест-раннер]]. Вот анонс, например: [Node.js — Node.js 20 is now available!](https://nodejs.org/en/blog/announcements/v20-release-announce#stable-test-runner)

Ящитаю, что это своего рода gamechanger:
- больше не надо ставить [[Jest]], [[Mocha]], [[Chai]], etc
- теперь жэст, моку, чай, etc можно смело выкидывать
- всё, что надо для [[unit-testing]] теперь с нами

Как запускать новый тест-раннер? Оч просто: `node --test dist`, где флаг `--test` запускает ноду в режиме тест-раннера, а параметр `dist` указывает в какой директории нода должна рекурсивно ([[Рекурсия]]) искать файлы с тестами. Ещё есть флаг `--experimental-test-coverage` , включает подсчёт покрытия кода тестами (об этом флаге чуть позже).

Сделал тут микропроектик с [[TypeScript]], чтобы показать вам как это выглядит.

Как выглядит выхлоп с 2мя тестами:
![[Pasted image 20240627202523.png]]

Сам код тестов (тут я тестирую какой-то класс). Отметьте, что структура теста **очень похожа** на то, если бы использовали jest, и используется исключено [[Node API]]. Ещё гляньте название файла. :)
![[Pasted image 20240627202631.png]]

А ещё ведь есть mock’инг! Но о нём предлагаю почитать отдельно, вот здесь: [Test runner - Node.js](https://nodejsdev.ru/api/test/#mocking)

Есть ещё один момент: как нода ищет тесты в вашем проекте. Вообще, она рекурсивно проходит по всей директории (где была запущена), и выполняет тесты в найденных тест-файлах.

Чтобы файл считался тест-файлом, он должен быть по-особому назван. И в целом мы можем контролировать поиск таких файлов; тут два варианта, которые можно комбинировать:

- именовать файлы по конвенции ([[Конвенция в программировании]]) например, `*.test.js` или `*_test.js` ; все варианты посмотрите тут: [https://nodejs.org/api/test.html#running-tests-from-the-command-line](https://nodejs.org/api/test.html#running-tests-from-the-command-line)
- точечно указать в какой директории искать, и/или указать конкретный файл

Ещё хотел вам показать выхлоп с флагом для отображения покрытия кода ([[покрытие кода]]) тестами:
![[Pasted image 20240627202652.png]]

Офф.дока по тестам в ноде не очень удобная, так что рекомендую изучить этот новый модуль вот здесь: [Test runner - Node.js](https://nodejsdev.ru/api/test/)